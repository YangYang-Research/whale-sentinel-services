name: Release Configs

on:
  push:
    tags:
      - 'v*-config'

jobs:
  release:
    runs-on: ubuntu-latest
    env:
      RELEASE_FILE: whale-sentinel-configs-${{ github.ref_name }}.zip

    steps:
      - uses: actions/checkout@v4

      - name: Zip config files
        run: |
          zip -r "$RELEASE_FILE" fluent-bit redis
          ls -lh "$RELEASE_FILE"

      - name: Check release file
        run: |
          if [ -f "$RELEASE_FILE" ]; then
            echo "✅ File exists"
            ls -lh "$RELEASE_FILE"
          else
            echo "❌ File not found"
            exit 1
          fi

      - name: Wait to ensure file flush
        run: sleep 2

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          name: "Release ${{ github.ref_name }}"
          tag_name: ${{ github.ref_name }}
          body: "Auto release of configuration files"
          files: ${{ env.RELEASE_FILE }}
          token: ${{ secrets.GH_PAT }}
